:javascript
  (function() {
    var onloadPicture = function(filename) {
      return function(event) {
        var fileDiv = $('<div>', { class: 'picture-container new-file' })
          .append($('<img>', { class: 'uploaded', src: event.target.result }))
          .append($('<div>', { class: 'picture-title' }).text(filename));

        $('.assay > .upload-new-file')
          .append(fileDiv);
      }
    }

    // Drag Picture to an input file and preview it
    $('#laboratory_sample_test_qc_result_attributes_files').on('change', function(e) {
      var files = e.target.files;

      for(var i = 0; i < files.length; i++) {
        var name = files[i].name;

        var reader = new FileReader();
        reader.onload = onloadPicture(name);
        reader.readAsDataURL(files[i]);
      }

      if (files.length > 0) {
        $('#undo_added_files').removeClass('hidden');
      }
    });

    // Change the class on the target zone when dragging a file over it
    $(".clear-label").on('click', function(e) {
      $(this).closest('.file-uploaded').addClass('remove');
      e.stopPropagation();
    });

    $("#add-note").on('click', function (e) {
      e.preventDefault()

      var newNote = {
        info: "by #{current_user.full_name}",
        description: $('#new-note').val().trim()
      };

      if (newNote.description === "") {
        return;
      }

      // clear input
      $('#new-note').val('');

      var note = $('<div>', { class: 'note'})
        .append($('<div>', { class: 'info' }).text(newNote.info))
        .append($('<div>', { class: 'description' }).text(newNote.description))
        .append($('<div>', { class: 'dashed-line' }));

      var inputHidden = $('<input>', {
        type: 'hidden',
        name: 'laboratory_sample[new_notes][]'
      }).val(newNote.description);

      $('#notes').append(note).append(inputHidden);
    });

    $('.assay > .upload-new-file').on('scroll', function(e) {
      var scrollDiff = $(this).scrollTop();
      // move dropzone-input into view
      $('.upload-picture').css('top', scrollDiff);
    });

    // Reset
    $('#undo_added_files').on('click', function(e) {
      event.preventDefault();

      // remove file preview
      $('.new-file').remove();
      // hide button
      $('#undo_added_files').addClass('hidden');

      // remove files from input FileList
      var emptyClonedInput = $('#laboratory_sample_test_qc_result_attributes_files').val('').clone(true);
      $('#laboratory_sample_test_qc_result_attributes_files')
        .replaceWith(emptyClonedInput);
    });
  })();

  document.addEventListener("dragenter", function( event ) {
    if ( event.target.className == "upload-picture" ) {
      $('.choose-picture').addClass('on');
    }

  }, false);

  document.addEventListener("dragleave", function( event ) {
    if ( event.target.className == "upload-picture" ) {
      $('.choose-picture').removeClass('on');
    }
  }, false);
